# End the play if we're not on Linux and a raw 'sudo' command isn't available.
# Expects connection:local

- shell: uname -s
  register: out
  check_mode: false
  changed_when: false
  tags:
    - always

- meta: end_play
  when: out.stdout != 'Linux'
  tags:
    - always

- command: sudo -n whoami
  args:
    warn: false
  ignore_errors: true
  register: sudo_available
  check_mode: false
  changed_when: false
  tags:
    - always

- meta: end_play
  when: sudo_available.rc != 0
  tags:
    - always
